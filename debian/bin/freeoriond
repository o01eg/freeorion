#!/bin/sh

set -e

ROOT=/usr/share/games/freeorion
cd ${ROOT}
printf 'CWD: '
pwd

DATAPATH="--resource.path /usr/share/games/freeorion/default"

GAME_UID=FO0019

SAVEFILE=`ls -t /var/lib/freeorion/save/${GAME_UID}/*.mps | head -n1`

if [ -f "${SAVEFILE}" ];
then
  SAVEARGS="--load ${SAVEFILE}"
else
  SAVEARGS="-q"
fi

FIRST_TURN_ARGS="" # --network.server.turn-timeout.first-turn-time "$(date -u "+%Y-%m-%d 00:00:00" -d "+2 days")"

LD_LIBRARY_PATH="/usr/lib/freeorion:${LD_LIBRARY_PATH}" \
/usr/lib/freeorion/freeoriond --setup.game.uid ${GAME_UID} ${FIRST_TURN_ARGS} ${DATAPATH} ${SAVEARGS} "$@"
EXITST=$?
if [ "${EXITST}" -ne 0 ];
then
  echo "Exit status: ${EXITST}"
fi
exit 11
