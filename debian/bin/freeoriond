#!/bin/sh

set -e

ROOT=/usr/share/games/freeorion
cd ${ROOT}
printf 'CWD: '
pwd

GAME_UID=FO0009

DATAPATH="--resource-dir /usr/share/games/freeorion/default"

SAVEFILE=`ls -t /var/lib/freeorion/save/${GAME_UID}/*.mps | head -n1`

if [ -f "${SAVEFILE}" ];
then
  SAVEARGS="--load ${SAVEFILE}"
else
  SAVEARGS="-q"
fi

LD_LIBRARY_PATH="/usr/lib/freeorion:${LD_LIBRARY_PATH}" \
/usr/lib/freeorion/freeoriond --setup.game.uid ${GAME_UID} --network.server.turn-timeout.first-turn-time "$(date -u "+%Y-%m-%d 00:00:00" -d "+2 days")"  ${DATAPATH} ${SAVEARGS} "$@"
EXITST=$?
if [ ${EXITST} -ne 0 ];
then
  # do something on fail
fi
exit ${EXITST}
